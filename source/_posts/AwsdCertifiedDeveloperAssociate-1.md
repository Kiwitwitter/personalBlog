---
title: Aws Certified Developer Associate, ELBs
date: 2020-08-02 22:53:02
tags:
- study
- aws_certified_developer_associate
---

## Elastic Load Balacing (ELB) Overview

### What is Load balancing?

* Load balancers are servers that forward internet traffic to multiple servers (EC2 Instances) downstream.

### Why use a load balancer?

* Spread load across multiple downstream instances
* Expose a single point of access (DNS) to your application
* Seamlessly handle failures of downstream insatnces
* Do regular health checks to your instances
* Provide SSL termination (HTTPS) for your websites
* Enforce stickiness with cookies
* High availabilities across zones
* Separate public traffic from private traffic

### Why use an EC2 Load Balancer?

* An ELB (EC2 Load Balancer) is a managed load balancer
  * AWS guarantees that it will be working
  * AWS takes care of upgrades, maintenance, high availability
  * AWS provides only a few configuration knobs
* It costs less to setup your own load balancer but it will be a lot more effort on your end
* It is integrated with many AWS offerings / services

### Types of Load Balancers on AWS

* AWS has three kinds of Load Balancers:
  1. Classic Load Balancer (v1 - Old generation)
  2. Application Load Balancer (v2 - New generation)
  3. Network Load Balancer (v2 - New generation)

* Overall, it is recommended to use the newer / v2 generation load balancers as they provide more features. 
* You can setup internal (private) or external (public ) ELBs

### Health Checks

* Health checks are crucial for load balancers because this enable thre load balancer to know if instancers it forwards traffic to are available to reply to requests
* The health check is done on a port and a route, usually /health
* If response if not 200, the instance is unhealthy.

### Good to Knows

* Classic Load Balancers are deprecated
* CLB, ALB, NLB support SSL certificated and provide SSL termination
* LBs can scale out, but not instantaneously, need to contact AWS for a warm-up
* Any LB has a static host name, Do not resolve and use underlying IP
* Troubleshooting:
  1. 4xx errors are clients induced errors
  2. 5xx errors are application induced errors
  3. LB errors 503 means at capacity or no registered target
  4. If the LB can't connect to your application, check you security group
* Monitoring
  1. ELB access logs will log all access request,
  2. CloudWatch Metrics will give user aggregated statistics

### Application load balancer (v2)

* ALB (Layer 7) allows to do:
  1. Load balancing to multiple HTTP applications across macchines (target groups)
  2. Load balancing to multiple applications on the same machine
  3. Load balancing based on route in URL
  4. Load balancing based on hostbane in URL
* Basically, they're awesome for micro services and container-based applications, Like Docker and Amazon ECS
* Has a port mapping feature to redirect to a dynamic port
* In comparison, we would need to create one Classic Load Balancer per application before, which is expensive and inefficient.
* Good to know:
  * Stickiness can be enabled at the target group level
    1. Same request goes to the same instance
    2. Stickiness is directly generated by the ALB, not the application
  * ALB support HTTP/HTTPS and Websockets protocols
  * The application server don't see the IP of the client directly
    1. The true IP of the client is inserted into header **X-Forwarded-For**
    2. We can also get Port(**X-Forwarded-Port**) and proto(**X-Forwarded-Proto**)

### Network Load Balancer (v2)

* Network Load Balancer (Layer 4) allows to do:
  1. Forward TCP traffic to your instances
  2. Handle millions of request per seconds
  3. Support for static IP or elastic IP
  4. Less latency (~100 ms vs 400 ms for ALB)
* NLB are mostly used for extreme performance and should not be the default load balancer you choose
* Overall, the creation process is the same as ALBs
* Good to know:
  * NLB directly sees the client IP

## Auto Scaling Group (ASG) Overview

### What is Auto Scaling Group?

In real-life, the load on the website and application can change and in cloud, people can create and get rid of servers very quickly. The goal of the an ASG is to:

1. Scale out to match an increased load
2. Scale in to match an decreased load
3. Ensure we have a minimum and a maximum number of machines running
4. Automatically Register new instances to a load balancer

### ASG Atrributes:

* A launch Configuration:
  * AMI + Instance Type
  * EC2 User Data
  * EBS Volumes
  * Security Groups
  * SSH Key Pair
* Min SIze/ Max Size/ Initial Capacity
* Network + Subnets Information
* Load Balancer Information
* Scaling Policies

### Auto Scaling Alarms

* It is possible to scale an ASG based on CLoudwatch Alarms
* An Alarm monitors a metric(Such as Average CPU)
* **Metrics are computed for the overall ASG instances**
* Based on the alarms, we can create scale-out/in policies
* Can do better rules  directly managed by EC2:
  * target Average CPU Usage
  * Number of request on the ELB per instance
  * Average Network In/Out
* Can define custom metrics:
  * Send custome metrics from application on EC2 to CloudWatch(PutMetric API)
  * Create CloudWatch alarm to react to low/high values
  * Use the CloudWatch alarm as the scaling policy for ASGs

### Scaling Policies

* Target Tracking Scaling, which is most easy to set-up
  e.g. Want the average ASG CPU stays around 40% 

* Simple/ Step Scaling
  e.g. When a CloudWatch Alarm is triggered

* Scheduled Actions

  e.g. Anticipate a scaling based on known usage pattern

### Scaling Cooldowns

The cooldown period helps to ensure that your Auto Scalfing group doesn't launch or terminate additional instances before the previous scaling activity takes effect.

In addition to default cooldown for ASG, we can create cooldowns that apply to a specific scaling policy, andi  will override t5he default cooldown period.



